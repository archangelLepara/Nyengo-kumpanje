<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Nyengo-Kumpanje Dashboard</title>
<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
<script src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_KEY"></script>
<script src="{{ url_for('static', filename='script.js') }}"></script>
</head>
<body>
<h1>Welcome, {{ user.name }}</h1>
<h2>Status in {{ user.district }}: {{ status }}</h2>

{% if safe_place %}
<div id="map" style="width: 100%; height: 400px;"></div>
<p>Safe Place: {{ safe_place.name }}</p>
{% endif %}

<h3>Emergency Numbers</h3>
<ul>
    <li>Police: 997</li>
    <li>Ambulance: 998</li>
    <li>Fire: 999</li>
</ul>
</body>
<script>
let safeLat = {{ safe_place.lat if safe_place else 0 }};
let safeLng = {{ safe_place.lng if safe_place else 0 }};

function initMap() {
    if(safeLat && safeLng){
        navigator.geolocation.getCurrentPosition(function(position) {
            const userLocation = { lat: position.coords.latitude, lng: position.coords.longitude };
            const map = new google.maps.Map(document.getElementById("map"), { zoom: 12, center: userLocation });
            const directionsService = new google.maps.DirectionsService();
            const directionsRenderer = new google.maps.DirectionsRenderer();
            directionsRenderer.setMap(map);

            directionsService.route({
                origin: userLocation,
                destination: {lat: safeLat, lng: safeLng},
                travelMode: 'DRIVING'
            }, (response, status) => {
                if(status === 'OK'){
                    directionsRenderer.setDirections(response);
                }
            });
        });
    }
}

window.onload = initMap;
</script>
</html>
